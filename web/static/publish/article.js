/*! bh-lay.com 2014-06-07 */
define(function(a){function b(a,b){var c=a.replace(/\{(\w*)}/g,function(){return b[arguments[1]]||""});return c}function c(a,b){a||b&&b("missing arguments"),$.ajax({url:"/ajax/blog",type:"GET",data:{content_format:"markdown",act:"get_detail",id:a},success:function(a){1!=a.code?b&&b("data error"):b&&b(null,a.detail)}})}function d(a,c){var d=b(g,c);a.html(d),mditor.bind(a.find("textarea.mditor")),a.find(".pub_cover_btn").click(function(){f.pop(function(b){if(b&&b.length>0){var c=b[0].url;a.find(".pub_row_image").css("backgroundImage","url("+c+")"),a.find('input[name="cover"]').val(c)}})}),admin.formToAjax(a,{onSubmit:function(){UI.prompt("正在提交博文修改！")},onResponse:function(){UI.prompt("博文修改完毕"),admin.push("/admin/"),admin.refresh()}})}function e(a,b){return b?void c(b,function(b,c){return b?void a.html("数据异常！"):void d(a,c)}):void d(a,{})}a("/frontEnd/publish/publish.css"),a("/frontEnd/mditor/mditor.js");var f=a("/frontEnd/gallery/index.js"),g=['<div class="pub_article"><form action="/ajax/add_edit" method="post" target="_self">','<div class="pub_row_input"><input type="text" placeholder="博文标题，必须要填的哦！" name="title" value="{title}"/></div>','<div class="pub_row_input">','<textarea placeholder="一段话概括博文" name="intro" cols="50" rows="5">{intro}</textarea>',"</div>",'<div class="pub_row_input">','<textarea class="mditor" placeholder="博文正文" name="content">{content}</textarea>',"</div>",'<div class="pub_row_image">','<div class="pub_row_image" style="background-image:url({cover});">','<a class="pub_cover_btn" href="javascript:void(0)">选择</a>',"</div>",'<input type="hidden" placeholder="缩略图" name="cover" value="{cover}" />',"</div>","<div>",'<input type="text" placeholder="标签" name="tags" value="{tags}" />','<input type="text" placeholder="作者" name="author" value="{author}" />','<input type="text" placeholder="发表时间" name="time_show" value="{time_show}" />',"</div>",'<div class="pub_sub">','<input type="hidden" name="id" value="{id}" />','<input type="hidden" name="category" value="blog" />','<button type="submit" class="btn btn-primary">提交</button>',"</div>","</form></div>"].join("");return e});