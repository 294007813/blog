/*! bh-lay.com 2014-06-07 */
define(function(a){function b(a,b){var c="";for(var d=0 in b)c+=a.replace(/{(\w*)}/g,function(){var a=arguments[1];return b[d][a]||""});return c}function c(a,b){$.ajax({url:"/ajax/asset/delDir",type:"POST",data:{path:a},dataType:"json",success:function(a){if(a&&200==a.code)b&&b(null);else{var c="删除失败,code("+(a.msg||"")+")";b&&b(c)}},error:function(){b&&b("网络出错")}})}function d(){var a=this,b=this.dom;b.on("click",'a[data-action="del"]',function(){a.del()}).on("click",'a[data-action="rename"]',function(){a.rename()}).on("click",".gP_item_toolBar",function(){b.hasClass("gP_item_menuing")?b.removeClass("gP_item_menuing"):(b.removeClass("gP_item_menuing"),b.addClass("gP_item_menuing"))}).on("click",".gP_item_check",function(){b.hasClass("gP_item_checked")?b.removeClass("gP_item_checked"):b.addClass("gP_item_checked")})}function e(a,c){this.fullname=c.name,this.path="/"+a+"/"+this.fullname,this.path=this.path.replace(/\/+/g,"/"),this.url="http://asset.bh-lay.com/"+this.path,this.status="normal";var e=b(g,[{name:this.fullname}]);this.dom=$(e),d.call(this)}a("/frontEnd/gallery/style.css");var f=(a("/frontEnd/util/uploader.js"),a("/frontEnd/util/event.js"),a("/frontEnd/util/panel.js"),a("/frontEnd/UI/pop.js")),g=['<div class="gP_item" data-type="folder" data-fullname="{name}">','<div class="gP_item_body">','<div class="gP_dir_item">','<div class="gP_file-ico"><span class="glyphicon glyphicon-folder-open"></span></div>','<div class="gP_file-name" title="{name}" >{name}</div>',"</div>",'<div class="gP_item_tools">','<div class="gP_item_toolsCnt">','<a href="javascript:void(0)" class="gP_tool_btn" data-action="del">','<span class="gP_tool_btn_ico"><span class="glyphicon glyphicon-trash"></span></span>','<strong class="gP_tool_btn_name">删除</strong>',"</a>",'<a href="javascript:void(0)" class="gP_tool_btn" data-action="rename">','<span class="gP_tool_btn_ico"><span class="glyphicon glyphicon-pencil"></span>','<strong class="gP_tool_btn_name">重命名</strong>',"</a>","</div>","</div>",'<a href="javascript:void(0)" class="gP_item_toolBar"><span class="glyphicon glyphicon-chevron-down"></span></a>','<a href="javascript:void(0)" class="gP_item_check"><span class="glyphicon glyphicon-unchecked"></span><span class="glyphicon glyphicon-check"></span></a>',"</div>","</div>"].join("");return e.prototype={del:function(){var a=this.path,b=this.dom;f.confirm({text:"删除就找不回来了，你再想想？",callback:function(){c(a,function(a){return a?void f.prompt(a):(b.addClass("gP_item_deleted"),b.css({position:"relative",height:b.find(".gP_item_body").height(),background:"#333"}),void b.find(".gP_item_body").css({position:"absolute",width:"100%",height:"100%"}).animate({left:"100%"},300,function(){b.slideUp(120,function(){b.remove()})}))})}})},rename:function(a){var b=this,c=f.ask("快想一个新名字！",function(c){var d=c;$.ajax({url:"/ajax/asset/rename",type:"POST",data:{pathname:b.path,newName:d},dataType:"json",success:function(c){c&&200==c.code&&(a&&a(null,c),b.dom.attr("data-fullname",d),b.dom.find(".gP_file-name").attr("title",d).html(d))},error:function(){a&&a("网络出错")}})});c.setValue(this.fullname)}},e});